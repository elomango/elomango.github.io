<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë°ì´í„° ê²€ì¦ ë„êµ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: #f9f9f9;
        }
        .correct {
            background: #d4edda;
            border-color: #28a745;
        }
        .incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background: #667eea;
            color: white;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ë°ì´í„° ê²€ì¦ ë„êµ¬</h1>

    <button onclick="runValidation()">ê²€ì¦ ì‹¤í–‰</button>
    <button onclick="clearAll()">ì´ˆê¸°í™”</button>

    <div class="comparison">
        <div>
            <h2>ì˜ˆìƒ ë°ì´í„° í˜•ì‹</h2>
            <div id="expectedData" class="section"></div>
        </div>
        <div>
            <h2>ì‹¤ì œ ìƒì„±ëœ ë°ì´í„°</h2>
            <div id="actualData" class="section"></div>
        </div>
    </div>

    <h2>ì˜ˆìƒ í…Œì´ë¸” ì¶œë ¥</h2>
    <table>
        <thead>
            <tr>
                <th style="width: 30px;"></th>
                <th>ë‚ ì§œ</th>
                <th>í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜</th>
                <th>ê±°ë˜ ìš”ì•½</th>
                <th>ìˆ˜ìµë¥ </th>
            </tr>
        </thead>
        <tbody id="expectedTable"></tbody>
    </table>

    <h2>ì‹¤ì œ í…Œì´ë¸” ì¶œë ¥</h2>
    <table>
        <thead>
            <tr>
                <th style="width: 30px;"></th>
                <th>ë‚ ì§œ</th>
                <th>í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜</th>
                <th>ê±°ë˜ ìš”ì•½</th>
                <th>ìˆ˜ìµë¥ </th>
            </tr>
        </thead>
        <tbody id="actualTable"></tbody>
    </table>

    <div id="validation" class="section"></div>

    <script src="app.js"></script>
    <script>
        function runValidation() {
            // ì˜ˆìƒë˜ëŠ” ì˜¬ë°”ë¥¸ ë°ì´í„° í˜•ì‹
            const expectedHistory = [
                {
                    date: '2021-02-26',
                    portfolioValue: 11514,
                    buyStocks: ['TMO', 'OKE', 'DIS'],
                    sellStocks: ['RL', 'REGN', 'CCL'],
                    return: '10.15'
                },
                {
                    date: '2021-05-27',
                    portfolioValue: 12645,
                    buyStocks: ['ZTS', 'GE', 'ITW'],
                    sellStocks: ['COR', 'DXCM', 'LH'],
                    return: '9.82'
                }
            ];

            // ì‹¤ì œ generateMockResultsë¡œ ìƒì„±ëœ ë°ì´í„°
            const params = {
                initialCapital: 10000,
                startDate: '2021-01-01',
                endDate: '2021-12-31',
                rebalancingPeriod: 90,
                numberOfStocks: 20,
                sp500Tickers: sp500Tickers || ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META']
            };

            const actualResult = generateMockResults(params);
            const actualHistory = actualResult.rebalancingHistory.slice(0, 2);

            // ë°ì´í„° êµ¬ì¡° í‘œì‹œ
            document.getElementById('expectedData').innerHTML = `
                <h4>ì²« ë²ˆì§¸ í•­ëª© êµ¬ì¡°:</h4>
                <pre>${JSON.stringify(expectedHistory[0], null, 2)}</pre>
                <h4>íƒ€ì… ì²´í¬:</h4>
                <pre>
date: ${typeof expectedHistory[0].date}
portfolioValue: ${typeof expectedHistory[0].portfolioValue}
buyStocks: ${Array.isArray(expectedHistory[0].buyStocks) ? 'Array' : typeof expectedHistory[0].buyStocks}
sellStocks: ${Array.isArray(expectedHistory[0].sellStocks) ? 'Array' : typeof expectedHistory[0].sellStocks}
return: ${typeof expectedHistory[0].return}
                </pre>
            `;

            document.getElementById('actualData').innerHTML = `
                <h4>ì²« ë²ˆì§¸ í•­ëª© êµ¬ì¡°:</h4>
                <pre>${JSON.stringify(actualHistory[0], null, 2)}</pre>
                <h4>íƒ€ì… ì²´í¬:</h4>
                <pre>
date: ${typeof actualHistory[0].date}
portfolioValue: ${typeof actualHistory[0].portfolioValue}
buyStocks: ${Array.isArray(actualHistory[0].buyStocks) ? 'Array' : typeof actualHistory[0].buyStocks}
sellStocks: ${Array.isArray(actualHistory[0].sellStocks) ? 'Array' : typeof actualHistory[0].sellStocks}
return: ${typeof actualHistory[0].return}
                </pre>
            `;

            // ì˜ˆìƒ í…Œì´ë¸” ë Œë”ë§
            renderTable(expectedHistory, 'expectedTable');

            // ì‹¤ì œ í…Œì´ë¸” ë Œë”ë§
            renderTable(actualHistory, 'actualTable');

            // ë°ì´í„° ê²€ì¦
            validateData(expectedHistory[0], actualHistory[0]);
        }

        function renderTable(history, tableId) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '';

            history.forEach((entry, index) => {
                const row = document.createElement('tr');
                const buyCount = entry.buyStocks ? entry.buyStocks.length : 0;
                const sellCount = entry.sellStocks ? entry.sellStocks.length : 0;
                const transactionSummary = `ë§¤ìˆ˜ ${buyCount}ì¢…ëª©, ë§¤ë„ ${sellCount}ì¢…ëª©`;
                const returnValue = parseFloat(entry.return || 0);

                row.innerHTML = `
                    <td><span>â–¶</span></td>
                    <td>${entry.date}</td>
                    <td>$${entry.portfolioValue ? entry.portfolioValue.toLocaleString() : '0'}</td>
                    <td>${transactionSummary}</td>
                    <td>${returnValue >= 0 ? '+' : ''}${returnValue.toFixed(2)}%</td>
                `;

                tbody.appendChild(row);
            });

            console.log(`${tableId} - Rendered ${history.length} rows`);
        }

        function validateData(expected, actual) {
            const issues = [];

            // ê° í•„ë“œ ê²€ì¦
            if (typeof actual.date !== 'string') {
                issues.push(`dateëŠ” stringì´ì–´ì•¼ í•˜ëŠ”ë° ${typeof actual.date}ì…ë‹ˆë‹¤.`);
            }
            if (typeof actual.portfolioValue !== 'number') {
                issues.push(`portfolioValueëŠ” numberì—¬ì•¼ í•˜ëŠ”ë° ${typeof actual.portfolioValue}ì…ë‹ˆë‹¤.`);
            }
            if (!Array.isArray(actual.buyStocks)) {
                issues.push(`buyStocksëŠ” ë°°ì—´ì´ì–´ì•¼ í•˜ëŠ”ë° ${typeof actual.buyStocks}ì…ë‹ˆë‹¤.`);
            }
            if (!Array.isArray(actual.sellStocks)) {
                issues.push(`sellStocksëŠ” ë°°ì—´ì´ì–´ì•¼ í•˜ëŠ”ë° ${typeof actual.sellStocks}ì…ë‹ˆë‹¤.`);
            }

            const validationDiv = document.getElementById('validation');
            if (issues.length === 0) {
                validationDiv.className = 'section correct';
                validationDiv.innerHTML = '<h3>âœ… ë°ì´í„° êµ¬ì¡°ê°€ ì˜¬ë°”ë¦…ë‹ˆë‹¤!</h3>';
            } else {
                validationDiv.className = 'section incorrect';
                validationDiv.innerHTML = `
                    <h3>âŒ ë°ì´í„° êµ¬ì¡° ë¬¸ì œ ë°œê²¬:</h3>
                    <ul>${issues.map(issue => `<li>${issue}</li>`).join('')}</ul>
                `;
            }
        }

        function clearAll() {
            document.getElementById('expectedData').innerHTML = '';
            document.getElementById('actualData').innerHTML = '';
            document.getElementById('expectedTable').innerHTML = '';
            document.getElementById('actualTable').innerHTML = '';
            document.getElementById('validation').innerHTML = '';
        }
    </script>
</body>
</html>