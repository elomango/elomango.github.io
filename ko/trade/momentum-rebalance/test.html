<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>S&P 500 ëª¨ë©˜í…€ ë¦¬ë°¸ëŸ°ì‹± - í…ŒìŠ¤íŠ¸ ëª¨ë“œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #5a6fd8;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .log-entry {
            margin: 2px 0;
        }
        .log-info { color: #58b3ff; }
        .log-success { color: #4ec9b0; }
        .log-error { color: #f48771; }
        .log-warn { color: #dcdcaa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª S&P 500 ëª¨ë©˜í…€ ë¦¬ë°¸ëŸ°ì‹± í…ŒìŠ¤íŠ¸</h1>

        <div class="test-info">
            <strong>âš ï¸ í…ŒìŠ¤íŠ¸ ëª¨ë“œ</strong><br>
            í˜„ì¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. 20ê°œ ì£¼ìš” ì¢…ëª©ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.<br>
            ì‹¤ì œ Yahoo Finance API ì—°ë™: <span id="apiStatus">ë¹„í™œì„±</span>
        </div>

        <div class="test-controls">
            <button onclick="testModuleLoading()">1. ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸</button>
            <button onclick="testAPIConnection()">2. API ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <button onclick="testMomentumCalc()">3. ëª¨ë©˜í…€ ê³„ì‚° í…ŒìŠ¤íŠ¸</button>
            <button onclick="testBacktest()">4. ë°±í…ŒìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ (Mock)</button>
            <button onclick="testRealData()">5. ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸ (1ì¢…ëª©)</button>
            <button onclick="clearConsole()">ì½˜ì†” ì§€ìš°ê¸°</button>
        </div>

        <h3>ì½˜ì†” ì¶œë ¥</h3>
        <div id="console" class="console"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Console override for display
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            log(args.join(' '), 'info');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            log('ERROR: ' + args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            log('WARN: ' + args.join(' '), 'warn');
        };

        function clearConsole() {
            consoleDiv.innerHTML = '';
            log('ì½˜ì†”ì„ ì§€ì› ìŠµë‹ˆë‹¤.', 'info');
        }

        // Test functions
        async function testModuleLoading() {
            log('=== ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');

            try {
                // Load modules
                await loadScript('../src/utils/api.js');
                log('âœ“ API ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ', 'success');

                await loadScript('../src/modules/momentum.js');
                log('âœ“ ëª¨ë©˜í…€ ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ', 'success');

                await loadScript('../src/modules/backtest.js');
                log('âœ“ ë°±í…ŒìŠ¤íŠ¸ ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ', 'success');

                // Check if classes are available
                if (typeof YahooFinanceAPI !== 'undefined') {
                    log('âœ“ YahooFinanceAPI í´ë˜ìŠ¤ ì‚¬ìš© ê°€ëŠ¥', 'success');
                }
                if (typeof MomentumCalculator !== 'undefined') {
                    log('âœ“ MomentumCalculator í´ë˜ìŠ¤ ì‚¬ìš© ê°€ëŠ¥', 'success');
                }
                if (typeof BacktestEngine !== 'undefined') {
                    log('âœ“ BacktestEngine í´ë˜ìŠ¤ ì‚¬ìš© ê°€ëŠ¥', 'success');
                }

                log('=== ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'success');
            } catch (error) {
                log(`ëª¨ë“ˆ ë¡œë”© ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testAPIConnection() {
            log('=== API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');

            try {
                const api = new YahooFinanceAPI();
                log('YahooFinanceAPI ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ', 'info');

                // Test with Apple stock
                const endDate = new Date().toISOString().split('T')[0];
                const startDate = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

                log(`AAPL ì£¼ê°€ ë°ì´í„° ìš”ì²­ (${startDate} ~ ${endDate})...`, 'info');
                const data = await api.fetchStockData('AAPL', startDate, endDate);

                if (data && data.prices && data.prices.length > 0) {
                    log(`âœ“ ë°ì´í„° ìˆ˜ì‹  ì„±ê³µ: ${data.prices.length}ê°œ ë°ì´í„° í¬ì¸íŠ¸`, 'success');
                    log(`  ìµœê·¼ ê°€ê²©: $${data.prices[data.prices.length - 1].toFixed(2)}`, 'info');
                    log(`  ì²« ê°€ê²©: $${data.prices[0].toFixed(2)}`, 'info');
                } else {
                    log('ë°ì´í„° ìˆ˜ì‹  ì‹¤íŒ¨', 'error');
                }

                log('=== API ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'success');
            } catch (error) {
                log(`API ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testMomentumCalc() {
            log('=== ëª¨ë©˜í…€ ê³„ì‚° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');

            try {
                const calc = new MomentumCalculator();

                // Mock data for testing
                const mockData = {
                    prices: [100, 102, 98, 105, 110, 108, 112, 115, 113, 118, 120],
                    dates: ['Day1', 'Day2', 'Day3', 'Day4', 'Day5', 'Day6', 'Day7', 'Day8', 'Day9', 'Day10', 'Day11']
                };

                const momentum = calc.calculateSingleStockMomentum(mockData, 5);
                log(`ëª¨ë©˜í…€ ê³„ì‚° ê²°ê³¼ (5ì¼): ${momentum.toFixed(2)}%`, 'success');

                // Test with multiple stocks
                const stocksData = {
                    'STOCK_A': { prices: [100, 110, 120, 130, 140] },
                    'STOCK_B': { prices: [100, 95, 90, 85, 80] },
                    'STOCK_C': { prices: [100, 105, 103, 108, 110] }
                };

                const momentumScores = calc.calculateMultipleStocksMomentum(stocksData, 4);
                log('ë³µìˆ˜ ì¢…ëª© ëª¨ë©˜í…€:', 'info');
                momentumScores.forEach(score => {
                    log(`  ${score.ticker}: ${score.momentum.toFixed(2)}%`, 'info');
                });

                const topStocks = calc.selectTopStocks(momentumScores, 2);
                log(`ìƒìœ„ 2ê°œ ì¢…ëª©: ${topStocks.map(s => s.ticker).join(', ')}`, 'success');

                log('=== ëª¨ë©˜í…€ ê³„ì‚° í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'success');
            } catch (error) {
                log(`ëª¨ë©˜í…€ ê³„ì‚° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testBacktest() {
            log('=== ë°±í…ŒìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ì‹œì‘ (Mock Data) ===', 'info');

            try {
                const params = {
                    initialCapital: 10000,
                    investmentPeriodValue: 1,
                    investmentPeriodUnit: 'years',
                    rebalancingPeriod: 30,
                    lookbackPeriod: 14,
                    numberOfStocks: 5,
                    startDate: '2023-01-01',
                    endDate: '2024-01-01',
                    sp500Tickers: ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META']
                };

                log('ë°±í…ŒìŠ¤íŠ¸ íŒŒë¼ë¯¸í„°:', 'info');
                log(`  ì´ˆê¸° ìë³¸: $${params.initialCapital}`, 'info');
                log(`  ê¸°ê°„: ${params.startDate} ~ ${params.endDate}`, 'info');
                log(`  ë¦¬ë°¸ëŸ°ì‹± ì£¼ê¸°: ${params.rebalancingPeriod}ì¼`, 'info');
                log(`  ë³´ìœ  ì¢…ëª© ìˆ˜: ${params.numberOfStocks}ê°œ`, 'info');

                // Simple mock backtest
                const results = {
                    finalValue: 12500,
                    totalReturn: 25,
                    cagr: 23.5,
                    maxDrawdown: 8.5
                };

                log('ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼:', 'success');
                log(`  ìµœì¢… ê°€ì¹˜: $${results.finalValue}`, 'success');
                log(`  ì´ ìˆ˜ìµë¥ : ${results.totalReturn}%`, 'success');
                log(`  ì—°í‰ê·  ìˆ˜ìµë¥ : ${results.cagr}%`, 'success');
                log(`  ìµœëŒ€ ë‚™í­: ${results.maxDrawdown}%`, 'info');

                log('=== ë°±í…ŒìŠ¤íŠ¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'success');
            } catch (error) {
                log(`ë°±í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testRealData() {
            log('=== ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹œì‘ (1ì¢…ëª©) ===', 'info');

            try {
                const api = new YahooFinanceAPI();

                // Test with SPY (S&P 500 ETF)
                const endDate = new Date().toISOString().split('T')[0];
                const startDate = new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

                log(`SPY ETF ë°ì´í„° ìš”ì²­ (${startDate} ~ ${endDate})...`, 'info');
                const data = await api.fetchStockData('SPY', startDate, endDate);

                if (data && data.prices) {
                    log(`âœ“ SPY ë°ì´í„° ìˆ˜ì‹ : ${data.prices.length}ê°œ ë°ì´í„° í¬ì¸íŠ¸`, 'success');

                    // Calculate momentum
                    const calc = new MomentumCalculator();
                    const momentum = calc.calculateSingleStockMomentum(data, 20);

                    if (momentum !== null) {
                        log(`âœ“ 20ì¼ ëª¨ë©˜í…€: ${momentum.toFixed(2)}%`, 'success');
                    }

                    // Calculate volatility
                    const volatility = calc.calculateVolatility(data, 20);
                    if (volatility !== null) {
                        log(`âœ“ ì—°ê°„ ë³€ë™ì„±: ${volatility.toFixed(2)}%`, 'success');
                    }
                }

                log('=== ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'success');
                document.getElementById('apiStatus').textContent = 'í™œì„± (í…ŒìŠ¤íŠ¸ ì„±ê³µ)';
                document.getElementById('apiStatus').style.color = 'green';
            } catch (error) {
                log(`ì‹¤ì œ ë°ì´í„° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                document.getElementById('apiStatus').textContent = 'ì˜¤ë¥˜';
                document.getElementById('apiStatus').style.color = 'red';
            }
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Initial log
        log('í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ', 'success');
        log('ì™¼ìª½ ë²„íŠ¼ë“¤ì„ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.', 'info');
    </script>
</body>
</html>